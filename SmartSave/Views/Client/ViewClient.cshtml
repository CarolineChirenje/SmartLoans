@model SmartDomain.Client;

@using SmartHelper;
@using System.Collections.Generic;
@{
    TempData["Title"] = "Employee Details";
}

<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
        @Model.ClientRef
    </h1>
</section>
<!-- Main content -->
<section class="content container-fluid">
    <!-- Horizontal Form -->
    <div class="box box-info">
        <div class="box-header with-border">
            <h3 class="box-title">@Model.ClientFullName</h3>
        </div>
        <!-- /.box-header -->
        <!-- form start -->
        <form class="form-horizontal" method="post" action="ViewClient">
            <div class="box-body">

                @if (TempData["Error"] != null)
                {<div class="container">
                        <div class="text-danger">@TempData["Error"].ToString()</div>
                    </div>
                    <br />
                }
                <div class="container">
                    @Html.ValidationSummary(false, "", new { @class = "text-danger" })
                </div>
                @if (TempData["Success"] != null)
                {<div class="container">
                        <div class="text-success">@TempData["Success"].ToString()</div>
                    </div>
                }
                @if (TempData["Warning"] != null)
                {<div class="container">
                        <div class="text-warning">@TempData["Warning"].ToString()</div>
                    </div>
                }
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Affiliation</label>

                    <div class="col-sm-10">
                        <select id="ClientGroupID" asp-for="ClientGroupID" class="form-control" asp-items="ViewBag.AffiliationList" onchange="GetCompanyList(this.value)">
                        </select>
                        <span id="AffiliationListNotFound" class="text-danger text-bold"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Company</label>
                    <div class="col-sm-10">

                        <select asp-for="CompanyID" id="CompanyList" name="CompanyID" class="form-control">
                        </select>
                        <span id="CompanyListNotFound" class="text-danger text-bold"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="ClientAccountTypeID" class="col-sm-2 control-label">Account Type</label>

                    <div class="col-sm-10">
                        <select asp-for="ClientAccountTypeID" class="form-control" asp-items="ViewBag.AccountTypes" onchange="showCoApplicantForm(this.value)">
                            <option value="">----</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Employee Number</label>
                    <div class="col-sm-10">
                        <label for="inputEmail3" class="form-control label-default">@Model.AccountNumber</label>
                    </div>
                </div>
                <section>
                    <h5 class="box-title">Applicant Information</h5>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Title</label>
                        <div class="col-sm-10">
                            <select asp-for="TitleID" class="form-control" asp-items="ViewBag.TitleList">
                                <option value="">----</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Initials</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="Initials" placeholder="Initials" value="@Model.Initials">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Last Name</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="LastName" placeholder="Last Name" value="@Model.LastName">

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">First Name</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="FirstName" placeholder="First Name" value="@Model.FirstName">
                        </div>
                    </div>


                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Last Name</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="LastName" placeholder="Last Name" value="@Model.LastName">

                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">National ID</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="IDNumber" placeholder="National ID" value="@Model.IDNumber">

                        </div>
                    </div>


                    <div class="form-group">
                        <label asp-for="DateOfBirth" class="col-sm-2 control-label">Date Of Birth</label>
                        <div class="col-sm-10">
                            <input asp-for="DateOfBirth" type="date" class="form-control" />
                            <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Gender</label>

                        <div class="col-sm-10">
                            <select asp-for="@Model.GenderID" class="form-control"
                                    asp-items="ViewBag.GenderList">
                                <option></option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Email</label>

                        <div class="col-sm-10">
                            <input type="email" class="form-control" name="EmailAddress" value="@Model.EmailAddress">
                        </div>

                    </div>


                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Address Line 1</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="AddressLine1" value="@Model.AddressLine1">

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Address Line 2</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="AddressLine2" value="@Model.AddressLine2">

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">City</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="City" value="@Model.City">

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Country</label>
                        <div class="col-sm-10">
                            <select asp-for="CountryID" class="form-control" asp-items="ViewBag.CountryList">
                                <option value="">----</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Mobile Number</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="MobileNumber" value="@Model.MobileNumber">

                        </div>
                    </div>


                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Status</label>
                        <div class="col-sm-10 checkbox">
                            <div class="form-group">

                                <div class="checkbox">
                                    <label>
                                        <input asp-for="IsActive" />
                                    </label>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label asp-for="DepartmentID" class="col-sm-2 control-label">Department</label>

                        <div class="col-sm-10">
                            <select asp-for="DepartmentID" class="form-control" asp-items="ViewBag.DepartmentList">
                                <option value="">----</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Occupation</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="Occupation" value="@Model.Occupation">

                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Salary</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="Salary" name="SalaryAmount" value="@Model.Salary">
                            <span id="SalaryError" class="text-danger text-bold"></span>
                            <span><a href="" class="text-success" data-toggle="modal" data-target="#SalaryHistory">History</a></span>
                        </div>
                    </div>
                </section>
                @if (Model.IsJointAccount && UtilityService.IsNotNull(Model.JointApplicant))
                {
                    <section id="CoApplicantInfo">
                        <h5 class="box-title">Co-Applicant Information</h5>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Relation</label>
                            <div class="col-sm-10">
                                <select asp-for="JointApplicant.RelationshipTypeID" class="form-control" asp-items="ViewBag.RelationTypes">
                                    <option value="">----</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Title</label>
                            <div class="col-sm-10">
                                <select asp-for="JointApplicant.ApplicantTitleID" class="form-control" asp-items="ViewBag.TitleList">
                                    <option value="">----</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Initials</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="JointApplicant.Initials" value="@Model.JointApplicant.Initials">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">First Name</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="JointApplicant.FirstName" value="@Model.JointApplicant.FirstName">

                            </div>
                        </div>

                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Last Name</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="JointApplicant.LastName" value="@Model.JointApplicant.LastName" required>

                            </div>
                        </div>

                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">ID Number</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="JointApplicant.IDNumber" value="@Model.JointApplicant.IDNumber" required>

                            </div>
                        </div>

                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Date Of Birth</label>

                            <div class="col-sm-10">
                                <input asp-for="@Model.JointApplicant.DateOfBirth" type="date" class="form-control" />
                                <span asp-validation-for="JointApplicant.DateOfBirth" class="text-danger"></span>
                            </div>

                        </div>

                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Gender</label>
                            <div class="col-sm-10">
                                <select asp-for="JointApplicant.ApplicantGenderID" class="form-control" asp-items="ViewBag.GenderList">
                                    <option value="">----</option>
                                </select>
                            </div>
                        </div>


                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Email</label>

                            <div class="col-sm-10">
                                <input type="email" class="form-control" asp-for="JointApplicant.EmailAddress" value="@Model.JointApplicant.EmailAddress" required>
                            </div>

                        </div>

                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Address Line 1</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="JointApplicant.AddressLine1" value="@Model.JointApplicant.AddressLine1">

                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Address Line 2</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="JointApplicant.AddressLine2" value="@Model.JointApplicant.AddressLine2">

                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">City</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="JointApplicant.City" value="@Model.JointApplicant.City">

                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Country</label>
                            <div class="col-sm-10">
                                <select asp-for="JointApplicant.CountryID" class="form-control" asp-items="ViewBag.CountryList">
                                    <option value="">----</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Mobile Number</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" asp-for="JointApplicant.MobileNumber" value="@Model.JointApplicant.MobileNumber">

                            </div>
                        </div>
                        <input type="hidden" asp-for="@Model.JointApplicant.JointApplicantID" value="@Model.JointApplicant.JointApplicantID" />
                    </section>
                }
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Registration Date</label>
                    <div class="col-sm-10">
                        <label for="inputEmail3" class="form-control label-default">@UtilityService.ShowDateTime(@Model.RegistrationDate)</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Last Changed By</label>
                    <div class="col-sm-10">
                        <label for="inputEmail3" class="form-control label-default">@Model.LastChangedBy</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="inputEmail3" class="col-sm-2 control-label">Last Updated</label>
                    <div class="col-sm-10">
                        <label for="inputEmail3" class="form-control label-default">@UtilityService.ShowDateTime(@Model.LastChangedDate)</label>
                    </div>
                </div>
                <input type="hidden" name="ClientID" value="@Model.ClientID" />
            </div>

            <!-- /.box-body -->
            <div class="box-footer">
                <a class="btn btn-default" asp-controller="Client" asp-action="Clients">Cancel</a>
                @if (UtilityService.HasPermission(Permissions.Update_Client) && (UtilityService.UserType != (int)TypeOfUser.Employee))
                {
                    <button type="submit" class="btn btn-info pull-right">Update</button>
                }
                @if (UtilityService.HasPermission(Permissions.Client_Update_Personal_Details) && (UtilityService.UserType == (int)TypeOfUser.Employee))
                {
                    <button type="submit" class="btn btn-info pull-right">Update My Personal Details</button>@String.Empty;
                }

                @if (UtilityService.HasPermission(Permissions.Delete_Client))
                {
                    <a class="btn btn-danger" asp-controller="Client" asp-action="Delete" asp-route-id="@Model.ClientID">Delete</a>
                }
            </div>
            <!-- /.box-footer -->


        </form>
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Additional Information
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <!-- Nav tabs -->

                        <ul class="nav nav-tabs" id="myTab">

                            @if (UtilityService.HasPermission(Permissions.View_Client_Product))
                            {
                                <li class="active">
                                    <a href="#Products" data-toggle="tab">Products</a>
                                </li>
                            }

                            @if (UtilityService.HasPermission(Permissions.View_Client_Payments))
                            {
                                <li>
                                    <a href="#Accounts" data-toggle="tab">Payments File</a>
                                </li>

                            }

                            @if (UtilityService.HasPermission(Permissions.View_Client_Outstanding_Payments))
                            {
                                if (Model.ClientFees != null)
                                {
                                    var fees = Model.ClientFees.Where(cf => !cf.IsPaid);
                                    if (fees != null)
                                    {
                                        if (fees.Count() > 0)
                                        {
                                            <li>
                                                <a href="#OutstandingPayments" data-toggle="tab">Outstanding Payments</a>
                                            </li>

                                        }
                                    }
                                }

                            }

                            @if (UtilityService.HasPermission(Permissions.View_Client_Deductions))
                            {
                                if (Model.InvoiceDetails != null)
                                {
                                    if (Model.InvoiceDetails.Count() > 0)
                                    {
                                        <li>
                                            <a href="#ClientDeductions" data-toggle="tab">Deduction Schedules</a>
                                        </li>

                                    }
                                }

                            }
                            @if (UtilityService.HasPermission(Permissions.Generate_Client_Statement))
                            {
                                <li>
                                    <a href="#Statements" data-toggle="tab">Statements</a>
                                </li>
                            }


                            @if (UtilityService.HasPermission(Permissions.View_Client_Course))
                            {
                                <li>
                                    <a href="#Courses" data-toggle="tab">Coaching Programmes</a>
                                </li>
                            }
                            @if (UtilityService.HasPermission(Permissions.View_Client_Note))
                            {
                                <li>
                                    <a href="#Notes" data-toggle="tab">Notes</a>
                                </li>
                            }


                            @if (UtilityService.HasPermission(Permissions.Client_View_Document))
                            {
                                <li>
                                    <a href="#Documents" data-toggle="tab">Documents</a>
                                </li>
                            }
                            @if (UtilityService.HasPermission(Permissions.View_Client_Dependent))
                            {
                                <li>
                                    <a href="#Dependents" data-toggle="tab">Dependents</a>
                                </li>
                            }
                            @if (UtilityService.HasPermission(Permissions.View_Client_Contact))
                            {
                                <li>
                                    <a href="#Contacts" data-toggle="tab">Contacts</a>
                                </li>
                            }
                            @if (UtilityService.HasPermission(Permissions.View_Client_Medical_Details))
                            {
                                <li>
                                    <a href="#MedicalDetails" data-toggle="tab">Medical Files</a>
                                </li>
                            }
                            @if (UtilityService.HasPermission(Permissions.View_Course_Intake_Register))
                            {
                                <li>
                                    <a href="#Register" data-toggle="tab">Attendance Register</a>
                                </li>
                            }

                        </ul>
                        <!-- Tab panes -->
                        <div class="tab-content">


                            <div class="tab-pane fade in active" id="Products">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Products
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Date Registered</th>
                                                    <th>Is Active</th>
                                                    <th>Last Changed By</th>
                                                    <th>Last Changed Date</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.ClientProducts != null)
                                                {
                                                    var activeProducts = Model.ClientProducts.OrderByDescending(x => x.DateRegistered);
                                                    @foreach (var item in activeProducts)
                                                    {
                                                        <tr>
                                                            @{

                                                                string dateRegistered = UtilityService.ShowDateTime(item.DateRegistered);
                                                                string LastChangedDate = UtilityService.ShowDateTime(item.LastChangedDate);
                                                                string activeStatus = UtilityService.ShowYesOrNo(item.IsActive);

                                                            }
                                                            @if (UtilityService.HasPermission(Permissions.Add_Client_Product))
                                                            {
                                                                <td><a asp-controller="Client" asp-action="ViewClientProduct" asp-route-id="@item.ClientProductID">@item.Product.Name</a></td>
                                                            }
                                                            else
                                                            {
                                                                <td>@item.Product.Name</td>
                                                            }
                                                            <td>@dateRegistered</td>
                                                            <td>@activeStatus</td>
                                                            <td>@Html.DisplayFor(modelItem => item.LastChangedBy)</td>
                                                            <td>@LastChangedDate</td>
                                                        </tr>
                                                    }
                                                }

                                        </table>
                                    </div>
                                    <div class="box-footer">
                                        @if (UtilityService.HasPermission(Permissions.Add_Client_Product))
                                        {
                                            <a class="btn  btn-small btn-success pull-right" data-toggle="modal" data-target="#ProductsForm">Add Product</a>}
                                    </div>
                                </div>
                            </div>


                            <div class="tab-pane fade in" id="Contacts">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Contacts
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>
                                                    <th>Contact</th>
                                                    <th>Contact Person</th>
                                                    <th>Information</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.ClientContacts != null)
                                                {

                                                    foreach (var item in Model.ClientContacts)
                                                    {
                                                        <tr>
                                                            <td>@Html.DisplayFor(modelItem => item.ContactType.Name)</td>
                                                            @if (UtilityService.HasPermission(Permissions.View_Client_Contact))
                                                            {
                                                                <td><a asp-controller="Client" asp-action="ViewContact" asp-route-id="@item.ClientContactID">@item.ContactPerson</a></td>
                                                            }
                                                            else
                                                            {
                                                                <td>@Html.DisplayFor(modelItem => item.ContactPerson)</td>
                                                            }

                                                            <td>@Html.DisplayFor(modelItem => item.Contact)</td>


                                                        </tr>
                                                    }
                                                }
                                        </table>
                                    </div>
                                </div>

                                <div class="box-footer">
                                    @if (UtilityService.HasPermission(Permissions.Add_Client_Contact))
                                    {
                                        <a class="btn  btn-small btn-success pull-right" data-toggle="modal" data-target="#ContactForm">Add Contact</a>
                                    }
                                </div>
                            </div>

                            <div class="tab-pane fade in" id="Courses">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Coaching Programmes
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Intake</th>
                                                    <th>Date Registered</th>
                                                    <th>Sessions</th>
                                                    <th>Date Completed</th>
                                                    <th>Is De-Registered</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.ClientCourses != null)
                                                {
                                                    var courses = Model.ClientCourses.OrderByDescending(x => x.DateRegistered);
                                                    @foreach (var item in courses)
                                                    {
                                                        <tr>
                                                            @{

                                                                string dateRegistered = UtilityService.ShowDateTime(item.DateRegistered);
                                                                string status = UtilityService.ShowYesOrNo(item.IsDeRegistered);
                                                                int sessions = item.Course.CourseOutlines == null ? 0 : item.Course.CourseOutlines.Count();
                                                                string dateCompleted = item.DateCompleted.HasValue ? UtilityService.ShowDateTime(item.DateCompleted) : "Not Complete";
                                                            }

                                                            <td><a asp-controller="Client" asp-action="ViewClientCourse" asp-route-id="@item.ClientCourseID">@item.Course.Title</a></td>
                                                            <td>@item.CourseIntake?.Duration</td>
                                                            <td>@dateRegistered</td>
                                                            <td>@sessions</td>
                                                            <td>@dateCompleted</td>
                                                            <td>@status</td>
                                                        </tr>
                                                    }
                                                }

                                        </table>
                                    </div>
                                    <div class="box-footer">
                                        @if (UtilityService.HasPermission(Permissions.Add_Client_Course))
                                        {
                                            <a class="btn  btn-small btn-success pull-right" data-toggle="modal" data-target="#CourseForm">Register</a>
                                        }
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade in" id="Notes">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Notes
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">

                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>
                                                    <th>Note Type</th>
                                                    <th>Initiator</th>
                                                    <th>Date Uploaded</th>
                                                    <th>Uploaded By</th>
                                                    <th>Due Date</th>
                                                    <th>Comments</th>
                                                    <th>Date Closed</th>
                                                    <th>Last Changed By</th>
                                                    <th>Last Changed Date</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.ClientNotes != null)
                                                {

                                                    var _activeNotes = Model.ClientNotes.OrderByDescending(x => x.DueDate);
                                                    var activeNotes = _activeNotes;
                                                    if ((TypeOfUser)UtilityService.UserType != TypeOfUser.Administrator)
                                                    {
                                                        activeNotes = _activeNotes.Where(n => !n.VisibleToAdminOnly).OrderByDescending(x => x.DueDate);
                                                    }
                                                    @foreach (var item in activeNotes)
                                                    {
                                                        <tr>
                                                            @{
                                                                string duedate = UtilityService.ShowDateTime(item.DueDate);
                                                                string closedDate = UtilityService.ShowDateTime(item.DateClosed);
                                                                string dateUploaded = UtilityService.ShowDateTime(item.DateUploaded);
                                                                string LastChangedDate = UtilityService.ShowDateTime(item.LastChangedDate);


                                                            }
                                                            <td>Client</td>
                                                            <td>@Html.DisplayFor(modelItem => item.UserType.Name)</td>
                                                            <td>@dateUploaded</td>
                                                            <td>@Html.DisplayFor(modelItem => item.UploadedBy)</td>
                                                            <td>@duedate</td>

                                                            <td><a asp-controller="Client" asp-action="ViewClientNote" asp-route-id="@item.ClientNoteID">@item.Comment</a> </td>
                                                            <td>@closedDate</td>
                                                            <td>@Html.DisplayFor(modelItem => item.LastChangedBy)</td>
                                                            <td>@LastChangedDate</td>
                                                        </tr>
                                                    }
                                                }

                                        </table>
                                    </div>

                                    <div class="box-footer">
                                        @if (UtilityService.HasPermission(Permissions.Add_Client_Note))
                                        {<a class="btn  btn-small btn-success pull-right" data-toggle="modal" data-target="#NotesForm">Add Note</a>
                                        }
                                    </div>
                                </div>
                            </div>


                            <div class="tab-pane fade in" id="MedicalDetails">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Medical Files
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>
                                                    <th>Preffered Doctor</th>
                                                    <th>Doctor Phone Number</th>
                                                    <th>Medical Aid</th>
                                                    <th>Medical Number</th>
                                                    <th>Preffered Hospital</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.ClientMedicalDetails != null)
                                                {

                                                    foreach (var item in Model.ClientMedicalDetails)
                                                    {
                                                        <tr>
                                                            <td><a asp-controller="Client" asp-action="ViewMedicalDetail" asp-route-id="@item.ClientMedicalID">@item.Doctor</a></td>
                                                            <td>@Html.DisplayFor(modelItem => item.Telephone)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.MedicalAid)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.MedicalAidNo)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.Hospital)</td>
                                                        </tr>
                                                    }
                                                }
                                        </table>
                                    </div>
                                </div>

                                <div class="box-footer">
                                    @if (UtilityService.HasPermission(Permissions.Add_Client_Medical_Details))
                                    {
                                        <a class="btn  btn-small btn-success pull-right" data-toggle="modal" data-target="#ClientMedicalForm">Create Medical Record</a>
                                    }
                                </div>
                            </div>

                            <div class="tab-pane fade" id="Documents">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Documents
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>
                                                    <th>Document Title</th>
                                                    <th>Comment</th>
                                                    <th>File Name</th>
                                                    <th>Uploaded By</th>
                                                    <th>Date Uploaded</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.ClientDocuments != null)
                                                {
                                                    @foreach (var item in Model.ClientDocuments)
                                                    {
                                                        <tr>
                                                            <td>@Html.DisplayFor(modelItem => item.DocumentType.Name)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.Comment)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.FileName)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.UploadedBy)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.DateUploaded)</td>

                                                            <td><a asp-controller="Client" asp-action="DownloadDocument" asp-route-id="@item.ClientDocumentID">Download</a> | <a asp-controller="Client" asp-action="ActionDocument" asp-route-id="@item.ClientDocumentID">Delete</a></td>
                                                        </tr>
                                                    }
                                                }
                                        </table>
                                    </div>
                                    <div class="box-footer">
                                        @if (UtilityService.HasPermission(Permissions.Client_Upload_Document))
                                        {
                                            <a class="btn  btn-small btn-success pull-right" data-toggle="modal" data-target="#DocumentForm">Upload Document</a>
                                        }
                                    </div>
                                </div>
                            </div>


                            <div class="tab-pane fade" id="Accounts">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Payments Files
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>
                                                    <th>Trans Ref</th>
                                                    <th>Entity</th>
                                                    <th>Transaction Type</th>

                                                    <th>Amount</th>
                                                    <th>Payment Status</th>
                                                    <th>Payment Date</th>
                                                    <th>Transaction Date</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.ClientPayments != null)
                                                {
                                                    var payments = Model.ClientPayments.OrderByDescending(c => c.TransactionDate);


                                                    @foreach (var item in payments)
                                                    {
                                                        <tr>
                                                            @{
                                                                string transactiondate = UtilityService.ShowDateTime(item.TransactionDate);
                                                                string paymentdate = UtilityService.ShowDate(item.PaymentDate);


                                                            }

                                                            <td><a asp-controller="Client" asp-action="ViewClientTransaction" asp-route-id="@item.TransactionID">@item.TransRef</a></td>

                                                            <td>@Html.DisplayFor(modelItem => item.Entity)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.TransactionType.TransType)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.TotalPaid)</td>

                                                            <td>@Html.DisplayFor(modelItem => item.PaymentStatus.Name)</td>
                                                            <td>@paymentdate</td>
                                                            <td>@transactiondate</td>
                                                        </tr>
                                                    }
                                                }

                                        </table>
                                    </div>

                                    <div class="box-footer">
                                        @if (UtilityService.HasPermission(Permissions.Capture_Payment))
                                        {
                                            <a class="btn  btn-small btn-success pull-right" asp-controller="Transactions" asp-action="AddTransaction" asp-route-ClientID="@Model.ClientID">Upload Payment</a>

                                        }
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="Statements">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Employee  Statements
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <form method="get" asp-controller="Client" asp-action="GenerateStatement">
                                        <div class="form-group">
                                            <label for="inputEmail3" class="col-sm-2 control-label">Statement Type:</label>
                                            <select asp-for="StatementID" class="form-control" asp-items="ViewBag.ClientStatement" onchange="showProduct(this.value)">
                                            </select>

                                        </div>
                                        <div id="ddlProduct" class="form-group">
                                            <label for="inputEmail3" class="col-sm-2 control-label">Registered Products:</label>
                                            <select asp-for="ProductID" class="form-control" asp-items="ViewBag.RegisteredProducts">
                                                <option value="">----</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <div class="form-group">
                                                <label for="inputEmail3" class="col-sm-2 control-label">Transaction Date From</label>
                                                <input type="date" class="form-control" name="StartDate" ID="StartDate" required>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="form-group">
                                                <label for="inputEmail3" class="col-sm-2 control-label">Transaction Date To</label>
                                                <input type="date" class="form-control" name="EndDate" ID="EndDate" required>
                                            </div>

                                        </div>
                                        @if (UtilityService.HasPermission(Permissions.Print_Statement_With_No_Reversals))
                                        {
                                            <div class="form-group">
                                                <label for="inputEmail3" class="col-sm-2 control-label">Print Reversals</label>
                                                <div class="checkbox">
                                                    <label class="checkbox-inline">
                                                        <input type="checkbox" data-val="true" id="PrintReversalsOnStatement"
                                                               name="PrintReversalsOnStatement" value="true">
                                                    </label>
                                                </div>
                                            </div>
                                        }
                                        <input type="hidden" name="ClientID" value="@Model.ClientID" />
                                        <div class="box-footer">
                                            @if (UtilityService.HasPermission(Permissions.Generate_Client_Statement))
                                            {
                                                <button type="submit" class="btn  btn-small btn-success" name="GenerateStatement" value="GenerateStatement">Generate Statement</button>
                                              <button type="submit" class="btn  btn-small btn-info" name="EmailStatement" value="EmailStatement" disabled="@UtilityService.FeatureFlagOn((int)FeatureFlagList.Enable_Document_Emailing_Functionality)">Email Statement</button>
                                            }
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="Dependents">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Dependents
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>
                                                    <th>Full Name</th>
                                                    <th>IDNumber</th>
                                                    <th>Occupation</th>
                                                    <th>Gender</th>
                                                    <th>Age</th>

                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.ClientDependents != null)
                                                {

                                                    foreach (var item in Model.ClientDependents)
                                                    {

                                                        <tr>
                                                            @{
                                                                string gender = ((GenderOrientation)item.GenderID).ToString();
                                                            }
                                                            <td><a asp-controller="Client" asp-action="ViewClientDependent" asp-route-id="@item.ClientDependentID" asp-route-Clientid="@Model.ClientID">@item.FullName</a> </td>
                                                            <td>@Html.DisplayFor(modelItem => item.IDNumber)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.Occupation)</td>
                                                            <td>@gender</td>
                                                            <td>@Html.DisplayFor(modelItem => item.Age)</td>
                                                        </tr>
                                                    }
                                                }
                                        </table>
                                    </div>
                                </div>

                                <div class="box-footer">
                                    @if (UtilityService.HasPermission(Permissions.Add_Client_Dependent))
                                    {
                                        <a class="btn  btn-small btn-success pull-right" data-toggle="modal" data-target="#DependentForm">Add Dependent</a>
                                    }
                                </div>
                            </div>

                            <div class="tab-pane fade in" id="OutstandingPayments">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Outstanding Payments
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <form method="get" asp-controller="Client" asp-action="GenerateOutStandingStatement">
                                        <div class="dataTable_wrapper">
                                            <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                                <thead>
                                                    <tr>

                                                        <th>Entity</th>
                                                        <th>Fee Name</th>
                                                        <th>Amount</th>
                                                        <th>Payment Terms</th>
                                                        <th>Due Date</th>
                                                        <th>Action</th>


                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @if (Model.ClientFees != null)
                                                    {
                                                        var outstandingProductPayments = Model.ClientFees.Where(p => p.ProductFeeID.HasValue).Distinct().ToList();

                                                        var outstandingCoursePayments = Model.ClientFees.Where(c => c.CourseFeeID.HasValue).Distinct();

                                                        if (outstandingProductPayments != null)
                                                        {
                                                            var cutoffDate = DateTime.Now.AddMonths(1);
                                                            var clientFees = outstandingProductPayments.Where(c => !c.IsPaid && c.DueDate.Date < cutoffDate.Date).OrderByDescending(x => x.DueDate);
                                                            @foreach (var item in clientFees)
                                                            {
                                                                <tr>
                                                                    @{

                                                                        string duedate = UtilityService.ShowDate(item.DueDate);
                                                                        string entity = "Product - " + item.ProductFee.Product.Name;
                                                                    }

                                                                    @if (UtilityService.HasPermission(Permissions.View_Product))
                                                                    {
                                                                        <td><a target="_blank" asp-controller="Product" asp-action="ViewProduct" asp-route-id="@item.ProductFee.ProductID">@entity</a></td>

                                                                    }
                                                                    else
                                                                    {
                                                                        <td>@entity</td>

                                                                    }
                                                                    @if (UtilityService.HasPermission(Permissions.View_Product_Fee))
                                                                    {
                                                                        <td><a target="_blank" asp-controller="Product" asp-action="ViewProductFee" asp-route-id="@item.ProductFee.ProductFeeID">@item.ProductFee.Name</a></td>

                                                                    }
                                                                    else
                                                                    {
                                                                        <td>@Html.DisplayFor(modelItem => item.ProductFee.Name)</td>
                                                                    }


                                                                    <td>@Html.DisplayFor(modelItem => item.Amount)</td>
                                                                    <td>@Html.DisplayFor(modelItem => item.ProductFee.Frequency.Name)</td>
                                                                    <td>
                                                                        @duedate
                                                                    </td>
                                                                    @if (UtilityService.HasPermission(Permissions.View_Client_Payments))
                                                                    {

                                                                        <td><a asp-controller="Client" asp-action="ClientFeePayment" asp-route-id="@item.ClientFeeID">View</a></td>
                                                                    }
                                                                </tr>
                                                            }

                                                        }

                                                        @if (outstandingCoursePayments != null)
                                                        {
                                                            var cutoffDate = DateTime.Now.AddMonths(1);
                                                            var clientFees = outstandingCoursePayments.Where(c => !c.IsPaid && c.DueDate.Date < cutoffDate.Date).OrderByDescending(x => x.DueDate);
                                                            @foreach (var item in clientFees)
                                                            {
                                                                <tr>
                                                                    @{

                                                                        string duedate = UtilityService.ShowDate(item.DueDate);
                                                                        string courseentity = "Course - " + item.CourseFee.Course.Title;

                                                                    }

                                                                    @if (UtilityService.HasPermission(Permissions.View_Course))
                                                                    {
                                                                        <td><a target="_blank" asp-controller="Courses" asp-action="ViewCourse" asp-route-id="@item.CourseFee.CourseID">@courseentity</a></td>

                                                                    }
                                                                    else
                                                                    {
                                                                        <td>@courseentity</td>

                                                                    }
                                                                    @if (UtilityService.HasPermission(Permissions.View_Course_Fee))
                                                                    {
                                                                        <td><a target="_blank" asp-controller="Courses" asp-action="ViewCourseFee" asp-route-id="@item.CourseFee.CourseFeeID">@item.CourseFee.Name</a></td>

                                                                    }
                                                                    else
                                                                    {
                                                                        <td>@Html.DisplayFor(modelItem => item.CourseFee.Name)</td>
                                                                    }


                                                                    <td>@Html.DisplayFor(modelItem => item.Amount)</td>
                                                                    <td>@Html.DisplayFor(modelItem => item.CourseFee.Frequency.Name)</td>
                                                                    <td>
                                                                        @duedate
                                                                    </td>
                                                                    @if (UtilityService.HasPermission(Permissions.View_Client_Payments))
                                                                    {

                                                                        <td><a asp-controller="Client" asp-action="ClientCourseFeePayment" asp-route-id="@item.ClientFeeID">View</a></td>
                                                                    }
                                                                </tr>
                                                            }

                                                        }
                                                    }
                                            </table>
                                        </div>
                                        <div class="box-footer">
                                            @if (UtilityService.HasPermission(Permissions.Generate_Client_Statement))
                                            {
                                                <button type="submit" class="btn  btn-small btn-success" name="GenerateOutStandingStatement" value="GenerateOutStandingStatement">Generate Statement</button>
                                                <button type="submit" class="btn  btn-small btn-info" name="EmailOutStandingStatement" value="EmailOutStandingStatement" disabled="@UtilityService.FeatureFlagOn((int)FeatureFlagList.Enable_Document_Emailing_Functionality)">Email Statement</button>
                                            }
                                        </div>
                                        <input type="hidden" name="ClientID" value="@Model.ClientID" />
                                    </form>
                                </div>
                            </div>


                            <div class="tab-pane fade in" id="ClientDeductions">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Deduction Schedules
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>

                                                    <th>Occupation</th>
                                                    <th>Salary</th>
                                                    <th>Product</th>
                                                    <th>Invoice Number</th>
                                                    <th>Invoice Date</th>
                                                    <th>Due Date</th>
                                                    <th>Amount Due</th>

                                                </tr>
                                            </thead>
                                            <tbody class="odd gradeX">
                                                @if (Model.InvoiceDetails != null)
                                                {
                                                    @foreach (var item in Model.InvoiceDetails)
                                                    {
                                                        <tr>
                                                            @{
                                                                string duedate = UtilityService.ShowDate(item.Invoice.DueDate);
                                                                string invoicedate = UtilityService.ShowDate(item.Invoice.InvoiceDate);
                                                            }

                                                            <td>@Html.DisplayFor(modelItem => item.Client.Occupation)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.Client.Salary)</td>
                                                            @if (UtilityService.HasPermission(Permissions.View_Product))
                                                            {
                                                                <td><a asp-controller="Product" asp-action="ViewProduct" asp-route-id="@item.ProductID">@item.Product.Name</a></td>
                                                            }
                                                            else
                                                            {
                                                                <td>@item.Product.Name</td>
                                                            }
                                                            <td>@item.InvoiceNumber</td>
                                                            <td>@invoicedate</td>
                                                            <td>@duedate</td>

                                                            <td>@Html.DisplayFor(modelItem => item.DeductedAmount)</td>



                                                        </tr>
                                                    }
                                                }

                                        </table>
                                    </div>
                                    <div class="box-footer">

                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade in" id="Register">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        Attendance Register
                                    </div>
                                </div>
                                <!-- /.panel-heading -->
                                <div class="panel-body">
                                    <div class="dataTable_wrapper">
                                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                            <thead>
                                                <tr>

                                                    <th>Course</th>
                                                    <th>Intake</th>
                                                    <th>Attendance Date</th>
                                                    <th>Status</th>

                                                </tr>
                                            </thead>
                                            <tbody class="odd gradeX">
                                                @if (Model.AttendanceRegister != null)
                                                {
                                                    @foreach (var item in Model.AttendanceRegister)
                                                    {
                                                        <tr>
                                                            <td>@Html.DisplayFor(modelItem => item.AttendanceRegister.CourseIntake.Course.Title)</td>
                                                            <td>@Html.DisplayFor(modelItem => item.AttendanceRegister.CourseIntake.Duration)</td>

                                                            <td>@item.AttendanceRegister.AttendanceDate</td>
                                                            <td>@item.AttendanceRegister.AttendanceRegisterDetails.FirstOrDefault()?.AttendanceStatus</td>
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="box-footer">

                                        <a class="btn  btn-small btn-success pull-right" data-toggle="modal" data-target="#">Print</a>
                                    </div>
                                </div>
                            </div>


                            <!-- /.panel-body -->
                        </div>
                        <!-- /.panel -->
                    </div>

                </div>
            </div>
        </div>

    </div>
    <!-- /.box -->
</section>

<!-- Modal HTML Markup -->
<!-- Modal -->
<div class="modal fade" id="NotesForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@Model.ClientRef</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" asp-controller="Client" asp-action="AddClientNote">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Comment:</label>
                        <textarea class="form-control" name="Comment" rows="5"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Due Date:</label>
                        <input type="date" class="form-control" name="DueDate" id="DueDate">
                    </div>

                    @if (UtilityService.UserType != (int)TypeOfUser.Employee)
                    {
                        <div class="form-group">
                            <div>
                                <label for="inputEmail3" class="col-sm-2 control-label">Visible To Admin Only:</label>

                                <div class="checkbox">
                                    <label class="checkbox-inline">
                                        <input type="checkbox" data-val="true" id="VisibleToAdminOnly"
                                               name="VisibleToAdminOnly" value="true">
                                    </label>
                                </div>
                            </div>
                        </div>
                    }
                    <input type="hidden" name="ClientID" value="@Model.ClientID" />

                </div>
                <div class="modal-footer">
                    @if (UtilityService.HasPermission(Permissions.Add_Client_Note))
                    {<button type="submit" class="btn btn-primary">Save Note</button>}
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="DocumentForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="width:800px">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@Model.ClientRef</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" asp-controller="Client" asp-action="AddClientDocument" enctype="multipart/form-data">
                <div class="modal-body">

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Document Type</label>
                        <select asp-for="DocumentTypeID" class="form-control" asp-items="ViewBag.DocumentsList">
                            <option value="">----</option>
                        </select>

                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Comment:</label>
                        <textarea class="form-control" name="Comment"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label"></label>

                        <input type="file" class="form-control" name="FileBytes">

                    </div>
                    <input type="hidden" name="ClientID" value="@Model.ClientID" />

                </div>
                <div class="modal-footer">
                    @if (UtilityService.HasPermission(Permissions.Client_Upload_Document))
                    {
                        <button type="submit" class="btn btn-primary">Upload</button>
                    }
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="ProductsForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@Model.ClientRef</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" asp-controller="Client" asp-action="AddClientProduct">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Product</label>
                        <select asp-for="ProductID" class="form-control" asp-items="ViewBag.ProductsAvailable">
                            <option value="">----</option>
                        </select>

                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Is Active</label>
                        <div class="checkbox">
                            <label class="checkbox-inline">
                                <input type="checkbox" data-val="true" id="IsActive"
                                       name="IsActive" value="true">
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Do Not Deduct</label>
                        <div class="checkbox">
                            <label class="checkbox-inline">
                                <input type="checkbox" data-val="true" id="DoNotDeduct"
                                       name="DoNotDeduct" value="true">
                            </label>
                            <span class="text-danger text-normal"><i>Will override all deductions set at individual or Product Level if selected </i></span>
                       </div>
                    </div>

                    <section><br/>
                        <h5 class="box-title text-danger text-normal"><i>Specific Individual Deductions (if any)</i></h5>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">Deduction</label>
                            <input type="text" class="form-control" asp-for="DeductionAmount" id="DeductionPercentage">
                            <span id="DeductionPercentageError" class="text-danger text-bold"></span>
                        </div>

                        <div class="form-group">
                            <label for="inputEmail3">Deduction After Salary Increment</label>
                            <input type="text" class="form-control" asp-for="IncreamentAmount" id="IncreamentPercentage">
                            <span id="IncreamentPercentageError" class="text-danger text-bold"></span>
                        </div>

                        <span class="text-danger text-normal"><i>Deductions defined at Product level will apply if do not deduct is not selected and individual deductions not specified not specified</i></span>
                    </section>
                    <input type="hidden" name="ClientID" value="@Model.ClientID" />
                    <input type="hidden" name="JointAccountEnumValue" value="@Model.JointAccountEnumValue" />
                </div>
                <div class="modal-footer">
                    @if (UtilityService.HasPermission(Permissions.Add_Client_Product))
                    {
                        <button type="submit" class="btn btn-primary">Save Product</button>}
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="CourseForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@Model.ClientRef</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" asp-controller="Client" asp-action="AddClientCourse">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Course</label>
                        <select asp-for="CourseID" class="form-control" asp-items="ViewBag.CourseList">
                            <option value="">----</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Intake</label>
                        <select asp-for="CourseIntakeID" class="form-control" asp-items="ViewBag.CourseIntakeList">
                            <option value="">----</option>
                        </select>
                    </div>
                    <input type="hidden" name="ClientID" value="@Model.ClientID" />
                </div>
                <div class="modal-footer">
                    @if (UtilityService.HasPermission(Permissions.Add_Client_Course))
                    {
                        <button type="submit" class="btn btn-primary">Register</button>}
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="ContactForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@Model.ClientRef</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" asp-controller="Client" asp-action="AddClientContact">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Contact Type</label>
                        <select asp-for="ContactTypeID" class="form-control" asp-items="ViewBag.ContactTypes">
                            <option value="">----</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Contact Person:</label>
                        <input type="text" class="form-control" name="ContactPerson">
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Relationship:</label>
                        <select asp-for="RelationshipTypeID" class="form-control" asp-items="ViewBag.RelationTypes">
                            <option value="">----</option>
                        </select>

                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Contact:</label>
                        <textarea class="form-control" name="Contact"></textarea>
                    </div>
                    <div class="form-group">
                        <div>
                            <label for="inputEmail3" class="col-sm-2 control-label">Is Active</label>
                            <div class="checkbox">
                                <label class="checkbox-inline">
                                    <input type="checkbox" data-val="true" id="IsActive"
                                           name="IsActive" value="true">
                                </label>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="ClientID" value="@Model.ClientID" />
                </div>
                <div class="modal-footer">
                    @if (UtilityService.HasPermission(Permissions.Add_Client_Contact))
                    {<button type="submit" class="btn btn-primary">Save Contact</button>}
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="ClientMedicalForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@Model.ClientRef</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" asp-controller="Client" asp-action="AddClientMedicalDetail">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Allergies <i>(If Any)</i>:</label>
                        <textarea class="form-control" name="Allergies"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Prescribed Medication  <i>(If Any)</i>:</label>
                        <textarea class="form-control" name="PrescribedMedication"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Preffered Hospital:</label>
                        <input type="text" class="form-control" name="Hospital">
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Preffered Doctor:</label>
                        <input type="text" class="form-control" name="Doctor">
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Doctor Phone Number:</label>
                        <input type="tel" class="form-control" name="Telephone">
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Medical Aid Name:</label>
                        <input type="text" class="form-control" name="MedicalAid">
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Medical Aid Number:</label>
                        <input type="tel" class="form-control" name="MedicalAidNo">
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Other Information  <i>(If Any)</i>:</label>
                        <textarea class="form-control" name="Other"></textarea>
                    </div>

                    <input type="hidden" name="ClientID" value="@Model.ClientID" />

                </div>
                <div class="modal-footer">
                    @if (UtilityService.HasPermission(Permissions.Add_Client_Medical_Details))
                    {
                        <button type="submit" class="btn btn-primary">Save</button>}
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="DependentForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@Model.ClientRef</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" asp-controller="Client" asp-action="AddClientDependent">
                <div class="modal-body">

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Firstname:</label>
                        <input type="text" class="form-control" name="FirstName">
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Lastname:</label>
                        <input type="text" class="form-control" name="LastName">
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">ID Number:</label>
                        <input type="tel" class="form-control" name="IDNumber">
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Date Of Birth</label>
                        <input type="date" class="form-control" name="DateOfBirth" required>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Gender</label>

                        <select asp-for="GenderID" class="form-control" asp-items="ViewBag.DependentGenderList">
                            <option value="">----</option>
                        </select>

                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">Occupation:</label>
                        <input type="text" class="form-control" name="Occupation">
                    </div>
                    <div class="form-group">
                        <div>
                            <label for="inputEmail3" class="col-sm-2 control-label">Is Active</label>
                            <div class="checkbox">
                                <label class="checkbox-inline">
                                    <input type="checkbox" data-val="true" id="IsActive"
                                           name="IsActive" value="true">
                                </label>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="ClientID" value="@Model.ClientID" />

                </div>
                <div class="modal-footer">
                    @if (UtilityService.HasPermission(Permissions.Add_Client_Dependent))
                    {
                        <button type="submit" class="btn btn-primary">Save</button>
                    }
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="SalaryHistory" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@Model.ClientRef</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form>
                <div class="modal-body">
                    <div class="panel-body">
                        <div class="dataTable_wrapper">
                            <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                                <thead>
                                    <tr>
                                        <th>Occupation</th>
                                        <th>Salary</th>
                                        <th>Last Changed By</th>
                                        <th>Last Changed Date</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model.ClientOccupationHistory != null)
                                    {

                                        foreach (var item in Model.ClientOccupationHistory)
                                        {

                                            <tr>
                                                @{
                                                    string lastChangedDate = UtilityService.ShowDateTime(item.LastChangedDate);
                                                }

                                                <td>@Html.DisplayFor(modelItem => item.Occupation)</td>
                                                <td>@Html.DisplayFor(modelItem => item.Salary)</td>
                                                <td>@Html.DisplayFor(modelItem => item.LastChangedBy)</td>
                                                <td>@lastChangedDate</td>

                                            </tr>
                                        }
                                    }
                            </table>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('a[data-toggle="tab"]').on('show.bs.tab', function (e) {
            localStorage.setItem('activeTab', $(e.target).attr('href'));
        });
        var activeTab = localStorage.getItem('activeTab');
        if (activeTab) {
            $('#myTab a[href="' + activeTab + '"]').tab('show');
        }
        StartDate
        var futureDate = new Date();
        futureDate.setDate(futureDate.getDate() + 60);
        var previousDate = new Date();
        previousDate.setDate(previousDate.getDate() - 60);
        document.getElementById('DueDate').value = new Date().toISOString().substring(0, 10);
        document.getElementById('StartDate').value = previousDate.toISOString().substring(0, 10);
        document.getElementById('EndDate').value = futureDate.toISOString().substring(0, 10);
        showCoApplicantForm();
        $('#ClientGroupID').trigger('change');

    });
    $(function () {
        $('#Salary').blur(function () {
            var tempVal = $('#Salary').val();
            console.debug(tempVal);
            if (tempVal != this.value.match(/^\d+\.?\d{0,2}/)) {
                $("#SalaryError").text("Only Decimal Numbers Separated by a Decimal Point Are Allowed in this field")
                $(":submit").attr("disabled", true);
            }
            else {
                $("#SalaryError").text("");
                $(":submit").removeAttr("disabled");
            }
        })

        $('#DeductionPercentage').blur(function () {
            var tempVal = $('#DeductionPercentage').val();
            if (tempVal != this.value.match(/^\d+\.?\d{0,2}/)) {
                $("#DeductionPercentageError").text("Only Decimal Numbers Separated by a Decimal Point Are Allowed in this field")
                $(":submit").attr("disabled", true);
            }
            else {
                $("#DeductionPercentageError").text("");
                $(":submit").removeAttr("disabled");
            }
        })

        $('#IncreamentPercentage').blur(function () {
            var tempVal = $('#IncreamentPercentage').val();
            if (tempVal != this.value.match(/^\d+\.?\d{0,2}/)) {
                $("#IncreamentPercentageError").text("Only Decimal Numbers Separated by a Decimal Point Are Allowed in this field")
                $(":submit").attr("disabled", true);
            }
            else {
                $("#IncreamentPercentageError").text("");
                $(":submit").removeAttr("disabled");
            }
        })
    })
    function showProduct(_statementID) {

        if (_statementID != 1) {
            $("#ddlProduct").hide();
        }
        else {
            $("#ddlProduct").show();
        }


    }
    function showCoApplicantForm(AccountTypeID) {
        var jointAccount = $("#JointAccountEnumValue").val();
        if (AccountTypeID === jointAccount) {
            $("#CoApplicantInfo").show();
        } else {
            $("#CoApplicantInfo").hide();
        }
    }
    function GetCompanyList(affiliationID) {
        var procemessage = "<option value='0'> Please wait whilst we retrieve Registered Companies...</option>";
        $("#CompanyList").html(procemessage).show();
        var url = "/Client/GetCompanyList/";
        // alert(affiliationID);
        $.ajax({
            url: url,
            data: { affiliationID: affiliationID },
            cache: false,
            type: "POST",
            success: function (data) {
                var markup = "";
                if (data == null || data.length == 0) {
                    if (affiliationID === 2) {
                        $("#AffiliationListNotFound").text("")
                    }
                    else {
                        $("#AffiliationListNotFound").text("No registered Companies Found")
                    }
                    $(":submit").attr("disabled", true);
                }
                else {
                    $("#AffiliationListNotFound").text("");
                    $(":submit").removeAttr("disabled");

                    for (var x = 0; x < data.length; x++) {
                        markup += "<option value=" + data[x].value + ">" + data[x].text + "</option>";
                    }
                }
                $("#CompanyList").html(markup).show();
            },
            error: function (reponse) {
                alert("error : " + reponse);
            }
        });

    }
</script>

